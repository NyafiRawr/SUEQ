# SUEQ-API
Сервер универсальной электронной очереди (Server Universal Electronic Queue) - WEB API: архитектура REST, с MYSQL, с авторизацией по токену JWT, формат передачи запросов JSON

- [x] 1. Создал проект WEB-API с ASP.NET (3.1) и настроил вывод при подключении к корню через браузер
- [x] 2. Создал папку Models и создал (таблицы) по схеме
- [x] 3. Создал класс SUEQContext в Models и указал сущности, которые он должен создавать
- [x] 4. Через NuGet добавил Pomelo.EntityFrameworkCore.MySql - для подключения к БД
- [x] 5. Подключил MySql и сделал строку подключения в ConfigureServices в Startup.cs
- [x] 6. Создал папку Controllers и контроллер для сущности пользователя, протестировал с помощью отправки POST через Postman и GET через браузер http://localhost:5433/api/users/1, разобрался как работает. Не сразу понял почему, если не указывать id, выдаёт всё, оказалось метода GET два: с аргументом id и без него, второй выдавал всё
- [x] 7. Осмотрел варианты авторизации по телефону, смс и гуглу
- [x] 8. Изучил https и разобрался как внедрить, но он нам не подходит, нужно сертифицироваться у третей стороны, что в зависимости от хостинга не бесплатно https://firstbyte.ru/ssl/. Но я оставил его, чтобы запустить в VS нужно включить SSL в свойствах проекта - отладка - в самом низу. И установить порт такой же в appsettings https_port (0 - выключено).
- [x] 9. Изучил варианты и виды аутентификации и примерные варианты реализации
- [x] 11. Вынес все настройки в appsettings.JSON и нормально подключил к проекту
- [x] 12. Добавил логгирование включения SSL и обращения к корню
- [x] 13. Добавил хэширование пароля
- [x] 14. Обрисовал логику сервера
- [x] 15. Реализовал работу с токеном

Схема авторизации:
1) На адрес нашего API авторизации (http://localhost:5433/api/users/login) для получения токена отсылаем почту и пароль, в api мы хэшируем его и сверяем с кэшировнным паролем в базе данных и если верный говорим об этом, получаем токен, иначе выдаём тело с ошибкой в любом случае возвращаем класс LoginResult
2) При обращении к другим нашим API клиент должен передавать полученный токен

- [x] 16. Добавил регистрацию и авторизацию, протестировал работу получаемого токена
- [x] 17. Реализовал функции управления пользователем (получение, обновление информации и удаление аккаунта)
- [ ] 18. Реализовал функции управления очередями
- [ ] 19. Реализовал функции позиций в очередях
- [ ] 20. Добавил подтверждение по почте

# База данных

То, что выполнил в базе данных для предоставления доступа:

```mysql
CREATE USER 'USERNAMEHERE'@'%' IDENTIFIED BY 'USERPASSWORDHERE';
GRANT ALL PRIVILEGES ON DBNAMEHERE.* TO 'USERNAMEHERE'@'%';
FLUSH PRIVILEGES;
```

# Логика (ПРИМЕРНАЯ)

АВТОРИЗАЦИЯ  

После этого доступно:  
	1) создать очередь / удалить её  
	2) встать в очередь / выйти из неё  
	3) управлять - если есть созданные очереди - открыть / закрыть / удалить стоящего в очереди клиента / изменить позицию стоящего в очереди  
	4) управление аккаунтом (изменить почту, пароль, фио или удалить аккаунт) ?  

СОЗДАТЬ  
	В форме юзер указывает название  
		отправляем на бэк и он возвращает QR код  
	Даём возможность сохранить и вывести на печать  
	Перекидываем во вкладку просмотр+управление  
УДАЛИТЬ  
	отправляем запрос на api/queues/{idqueue} (DELETE)  
ВСТАТЬ  
	Открываем камеру и ждём скана QR кода  
		отправляем на бэк поиск очереди по коду api/queues/qr (GET)  
		если найдена то получаем очередь api/positions/{idqueue} (GET)  
	Перекидываем в окно где виден список очереди  
ВЫЙТИ  
	api/positions/{iduser} (DELETE)  
ИЗМЕНИТЬ ПОЗИЦИЮ КЛИЕНТА  
	api/positions/ (PUT) в форме подать userid и новое место  
УДАЛИТЬ СТОЯЩЕГО В ОЧЕРЕДИ  
	api/positions/{iduser} (DELETE)  
ОТКРЫТЬ ИЛИ ЗАКРЫТЬ ОЧЕРЕДЬ  
	api/queues/ (PUT) в форме подать queueid и статус открыто/закрыто  
	
